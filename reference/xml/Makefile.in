SHELL=/bin/bash
XMLS:=$(shell ls ${CSGSHARE}/xml/*.xml | xargs -n1 basename )

all: $(XMLSTEX) 
wiki: $(XMLSWIKI)

.PHONY: clean boostrap 
.SECONDARY:


%.t2t: 
	./xml2t2t.sh $* > $@

%.tex: %.t2t
	./txt2tags -t tex --no-header --infile $< --outfile $@

%.wiki: %.t2t
	./txt2tags -t wiki --no-header --infile $< --outfile $@

clean:
	rm -f $(XMLST2T)
	rm -f $(XMLSTEX)
	rm -f $(XMLSWIKI)
	rm -f *~
	rm -f Makefile

bootstrap: 
	@if [ -z "${CSGSHARE}" ]; then \
	  echo CSGSHARE not defined >&2; \
	  exit 1; \
	fi
	echo $(XMLS) | sed 's/[[:space:]]\+/\n/g' | sed -e 's/.*/\t&.t2t\\/' -e '1i XMLST2T=\\' > Makefile
	echo >> Makefile
	echo $(XMLS) | sed 's/[[:space:]]\+/\n/g' | sed -e 's/.*/\t&.tex\\/' -e '1i XMLSTEX=\\' >> Makefile
	echo >> Makefile
	echo $(XMLS) | sed 's/[[:space:]]\+/\n/g' | sed -e 's/.*/\t&.wiki\\/' -e '1i XMLSWIKI=\\' >> Makefile
	echo >> Makefile
	cat Makefile.in >> Makefile
